# Dr Web test task

## Описание

Консольное приложение, имитирующее работу простой in-memory базы данных с поддержкой основных команд: SET, GET, UNSET, COUNTS, FIND. Данные хранятся только в оперативной памяти и не сохраняются между сеансами.

## Установка

1. Убедитесь, что у вас установлен Python 3.8+
2. Клонируйте репозиторий или скачайте файлы:

   ```
   git clone https://github.com/yutanov/dr_web_test_task.git
   cd dr_web_test_task
   ```

## Запуск приложения

Выполните команду:

```
python database.py
```

Или для Unix-систем:

```
python3 database.py
```

## Использование

После запуска вы увидите приглашение ввода `>`. Доступные команды:

### Основные команды

| Команда   | Описание                                                                 | Пример                   |
|-----------|--------------------------------------------------------------------------|--------------------------|
| SET       | Устанавливает значение переменной                                        | SET name value           |
| GET       | Возвращает значение переменной (NULL если не существует)                 | GET name                 |
| UNSET     | Удаляет переменную                                                       | UNSET name               |
| COUNTS    | Показывает количество переменных с указанным значением                   | COUNTS value             |
| FIND      | Находит все переменные с указанным значением                             | FIND value               |
| END       | Завершает работу приложения                                              | END                      |

### Команды транзакций

| Команда    | Описание                                                                 |
|------------|--------------------------------------------------------------------------|
| BEGIN      | Начинает новую транзакцию (можно вкладывать)                             |
| ROLLBACK   | Отменяет изменения текущей транзакции                                    |
| COMMIT     | Применяет изменения всех активных транзакций                             |
| END        | Завершает работу приложения                                              |

### Пример сеанса

**Основной функционал:**

```
> GET A
NULL
> SET A 10
> GET A
10
> COUNTS 10
1
> SET B 20
> SET C 10
> COUNTS 10
2
> FIND 10
A C
> UNSET B
> GET B
NULL
> END
```

**Простая транзакция:**

```
> SET A 10
> BEGIN
> SET A 20
> GET A
20
> ROLLBACK
> GET A
10
```

**Вложенные транзакции:**

```
> BEGIN
> SET A 30
> BEGIN
> SET A 40
> GET A
40
> ROLLBACK
> GET A
30
> COMMIT
```

## Запуск тестов

Для запуска тестов выполните:

```
python -m unittest test_database.py
```

Или:

```
python3 -m unittest test_database.py
```

### Описание тестов

Тестовая система включает:

1. **Unit-тесты**:
   - Проверка методов класса Database
   - Простые и вложенные транзакции
   - Тестирование отдельных команд

2. **Интеграционные тесты**:
   - Проверка работы CommandProcessor
   - End-to-end тестирование всего приложения

3. **Моки и заглушки**:
   - Эмуляция пользовательского ввода
   - Перехват вывода в консоль

## Ограничения

1. Все данные хранятся только в оперативной памяти
2. Аргументы команд не должны содержать пробелов
3. При COMMIT применяются все изменения всех уровней
4. ROLLBACK отменяет только текущий уровень транзакции
5. Автоматический откат при ошибках
